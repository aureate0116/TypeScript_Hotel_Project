import{m as F,g as V,_ as P,h as I,c as l,a as t,t as p,b as i,w as _,q as x,r as A,o as a,i as n,n as c,e as C,f as B,k as D,F as v,j as w,p as N,d as z}from"./index-rb2E022i.js";import{u as R}from"./userAuthStore-DoH6c3jF.js";import{Z as U}from"./zipcodes-YNp0Njm-.js";import{S as k}from"./sweetalert2.all-6m_Z_jZk.js";const q="https://hexschool-freyja.onrender.com/api/v1/";V("phone",d=>/^09\d{8}$/i.test(d));V("password",d=>/^(?=.*[A-Za-z]).*$/.test(d));const O={data(){return{userName:"",userInfo:{name:"",email:"",phone:"",birthday:"",address:{city:"",detail:"",zipcode:"",county:""},oldPassword:"",confirmPwd:"",newPassword:""},organizedData:{},cityArray:[],addressSelected:{city:"",county:"",zipcode:"",detail:""},dayRange:0,birthday:{year:"",month:"",day:""},showResetPwd:!1,isEditData:!1}},computed:{countyArray(){var d;return this.addressSelected.city?((d=this.organizedData[this.addressSelected.city])==null?void 0:d.countyList)||[]:[]}},watch:{"addressSelected.county":{handler(d){console.log("countyArray",this.countyArray),console.log("newValue",d);let s=this.countyArray.filter(f=>f.countyName==d.countyName);console.log("array",s),s.length>0&&(this.addressSelected.zipcode=s[0].ZipCode,console.log("this.addressSelected.zipcode",this.addressSelected.zipcode))},immediate:!0},"birthday.year":{handler:"handleBirthdayChange",immediate:!0},"birthday.month":{handler:"handleBirthdayChange",immediate:!0},"birthday.day":{handler:"handleBirthdayChange",immediate:!0}},methods:{...F(R,["getUserAccount","getToken"]),resetPwd(){this.showResetPwd=!0},saveAccount(){if(this.$refs.resetForm){let d={...this.userInfo},s={"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.getToken()}`};console.log("data",d),console.log("headers",s),this.$refs.resetForm.validate().then(f=>{f.valid&&this.axios.put(`${q}user/`,d,{headers:s}).then(h=>{console.log("res",h),console.log("res",JSON.stringify(h.data)),h.data.status?(console.log("res",h),k.fire({icon:"success",iconColor:"#dc3545",title:"修改成功",showConfirmButton:!1,width:"400px",customClass:{title:"fs-4"}}),this.showResetPwd=!1):k.fire({icon:"error",iconColor:"#dc3545",title:h.data.message,showConfirmButton:!1,width:"400px",customClass:{title:"fs-4"}})}).catch(h=>{console.log("err",h),k.fire({icon:"error",iconColor:"#C22538",title:h.response.data.message,showConfirmButton:!1,width:"400px",customClass:{title:"fs-4"}})})})}},changeStateToEdit(){this.isEditData=!0},saveUserData(){this.isEditData=!1},isLeapYear(d){return d%4===0&&d%100!==0||d%400===0},updateDayRange(d,s){const f=[1,3,5,7,8,10,12];this.dayRange=s===2?this.isLeapYear(d)?29:28:f.includes(s)?31:30},handleBirthdayChange(d){this.updateDayRange(this.birthday.year,d);const s=new Date(Number(this.birthday.year),Number(this.birthday.month)-1,Number(this.birthday.day));this.userInfo.birthday=s.toISOString(),console.log("this.registerData.birthday",this.userInfo.birthday)},handleAddressSelect(){U.forEach(d=>{const{city:s,county:f,zipcode:h}=d;this.organizedData[s]||(this.organizedData[s]={CityName:s,countyList:[]}),this.organizedData[s].countyList.push({ZipCode:String(h),countyName:f})}),this.cityArray=Object.keys(this.organizedData),console.log("123",Object.values(this.organizedData)[0]),console.log(" this.cityArray",this.cityArray)},handelBirthday(){let d=this.userInfo.birthday;const s=new Date(d);this.birthday.year=s.getFullYear().toString(),this.birthday.month=(s.getMonth()+1).toString(),this.birthday.day=s.getDate().toString(),console.log("birthday",d)}},mounted(){this.userInfo=this.getUserAccount(),this.userInfo?(this.addressSelected.detail=this.userInfo.address.detail,this.addressSelected.county=this.userInfo.address.county,this.addressSelected.city=this.userInfo.address.city,this.addressSelected.zipcode=this.userInfo.address.zipcode,console.log("userinfo",this.userInfo),console.log("document.cookie",document.cookie),console.log(" this.addressSelected",this.addressSelected),this.handleAddressSelect(),this.handelBirthday()):this.$router.push({name:"login"})}},r=d=>(N("data-v-3fd51deb"),d=d(),z(),d),j={class:"container-fluid p-0 bg-black"},L={class:"user_center_banner"},T={class:"container d-flex flex-column flex-lg-row align-items-start align-items-lg-center"},M=r(()=>t("img",{src:"https://github.com/hexschool/2022-web-layout-training/blob/main/typescript-hotel/%E6%A1%8C%E6%A9%9F%E7%89%88/user1.png?raw=true",alt:"img"},null,-1)),Y={class:"text-white"},Z={class:"container"},H=r(()=>t("ul",{class:"nav user_center_menu py-7 py-lg-8",id:"userInfo",role:"tablist"},[t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link active",id:"userData-tab","data-bs-toggle":"tab","data-bs-target":"#userData",type:"button",role:"tab","aria-controls":"userData","aria-selected":"true"}," 個人資料 ")]),t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"userOrder-tab","data-bs-toggle":"tab","data-bs-target":"#userOrder",type:"button",role:"tab","aria-controls":"userOrder","aria-selected":"false"}," 我的訂單 ")])],-1)),J={class:"tab-content w-100",id:"userInfoContent"},W={class:"tab-pane fade show active",id:"userData",role:"tabpanel","aria-labelledby":"userData-tab"},G={class:"d-flex flex-column flex-lg-row justify-content-between"},K={class:"content_left bg-white p-5 p-md-7 rounded-4"},Q=r(()=>t("h5",{class:"fw-bold mb-7"},"修改密碼",-1)),X={class:"mb-3"},$=r(()=>t("h6",null,"電子信箱",-1)),ee={class:"fw-bold"},se={class:"row align-items-center mb-3"},te={class:"col"},oe=r(()=>t("h6",null,"密碼",-1)),ae={key:0},le=r(()=>t("input",{type:"password",value:"testnumber",class:"border-0 fw-bold",disabled:""},null,-1)),de=[le],ie={class:"col text-end"},re={key:0,class:"mb-3"},ne=r(()=>t("h6",{class:"fw-bold"},"舊密碼",-1)),ue={key:1,class:"mb-3"},ce=r(()=>t("h6",{class:"fw-bold"},"新密碼",-1)),he={key:2,class:"mb-3"},me=r(()=>t("h6",{class:"fw-bold"},"確認新密碼",-1)),be={class:"content_right bg-white p-5 p-md-7 rounded-4 mt-3 mt-lg-0 ms-lg-7"},ye={class:"row flex-column"},fe=r(()=>t("h5",{class:"fw-bold mb-7"},"基本資料",-1)),pe={class:"col mb-3"},_e={key:0,class:"form-label",for:"name"},ve={key:1,class:"form-label",for:"name"},we={class:"col mb-3"},ge={key:0,class:"form-label",for:"phone"},Ce={key:1,class:"form-label",for:"phone"},Be={class:"col mb-3"},De={key:0,class:"form-label",for:"birthday",label:"生日"},Ae={key:1,class:"form-label",for:"birthday",label:"生日"},ke={class:"row g-2"},Ee={class:"col-md-4"},Se=["value"],xe=r(()=>t("option",{value:"",selected:""},"請選擇",-1)),Ve=["value"],Fe={key:0,class:"col-md-4"},Pe=r(()=>t("option",{value:"",selected:""},"請選擇",-1)),Ie=["value"],Ne={key:1,class:"col-md-4"},ze=r(()=>t("option",{value:"",selected:""},"請選擇",-1)),Re=["value"],Ue={key:2,class:"col-md-12 d-flex flex-row"},qe={class:"col mb-3"},Oe={key:0,class:"form-label",for:"address",label:"地址"},je={key:1,class:"form-label",for:"address",label:"地址"},Le={class:"row g-2"},Te=["value"],Me=r(()=>t("option",{value:"",selected:""},"請選擇",-1)),Ye=["value"],Ze={key:0,class:"col-md-6"},He=r(()=>t("option",{value:"",selected:""},"請選擇",-1)),Je=["value"],We={key:1,class:"col-md-12"},Ge={class:"col"},Ke=r(()=>t("div",{class:"tab-pane fade",role:"tabpanel","aria-labelledby":"userOrder-tab"},[t("div",{class:"row"},[t("div",{class:"col bg-white p-7 rounded-4"},"我的訂單"),t("div",{class:"col bg-white p-7 rounded-4"},"我的訂單")])],-1));function Qe(d,s,f,h,e,y){var S;const m=A("v-field"),b=A("ErrorMessage"),E=A("v-form"),g=I("required");return a(),l("div",j,[t("div",L,[t("div",T,[M,t("h1",Y,"Hello，"+p((S=e.userInfo)==null?void 0:S.name),1)])]),t("div",Z,[H,t("div",J,[t("div",W,[t("div",G,[i(E,{ref:"resetForm",onSubmit:x(y.saveAccount,["prevent"]),class:"content_left"},{default:_(({errors:u})=>[t("div",K,[Q,t("div",X,[$,t("p",ee,p(e.userInfo.email),1)]),t("div",se,[t("div",te,[oe,e.showResetPwd?n("",!0):(a(),l("div",ae,de))]),t("div",ie,[t("button",{class:"btn border-0 text-primary text-decoration-underline",onClick:s[0]||(s[0]=x((...o)=>y.resetPwd&&y.resetPwd(...o),["prevent"]))}," 重設 ")])]),e.showResetPwd?(a(),l("div",re,[ne,i(m,{name:"oldPassword",label:"舊密碼",type:"password",class:c(["form-control",{"is-invalid":u.oldPassword}]),id:"oldPassword",placeholder:"請輸入舊密碼",modelValue:e.userInfo.oldPassword,"onUpdate:modelValue":s[1]||(s[1]=o=>e.userInfo.oldPassword=o),rules:"required|min:8|password"},null,8,["class","modelValue"]),i(b,{name:"oldPassword",class:"invalid-feedback"})])):n("",!0),e.showResetPwd?(a(),l("div",ue,[ce,i(m,{name:"newPassword",label:"新密碼",type:"password",class:c(["form-control",{"is-invalid":u.newPassword}]),id:"newPassword",placeholder:"請輸入新密碼",modelValue:e.userInfo.newPassword,"onUpdate:modelValue":s[2]||(s[2]=o=>e.userInfo.newPassword=o),rules:"required|min:8|password"},null,8,["class","modelValue"]),i(b,{name:"newPassword",class:"invalid-feedback"})])):n("",!0),e.showResetPwd?(a(),l("div",he,[me,i(m,{name:"confirmPassword",label:"確認新密碼",type:"password",class:c(["form-control",{"is-invalid":u.confirmPassword}]),id:"confirmPassword",placeholder:"請再輸入一次密碼",modelValue:e.userInfo.confirmPwd,"onUpdate:modelValue":s[3]||(s[3]=o=>e.userInfo.confirmPwd=o),rules:"required|confirmed:@newPassword"},null,8,["class","modelValue"]),i(b,{name:"confirmPassword",class:"invalid-feedback"})])):n("",!0),e.showResetPwd?(a(),l("button",{key:3,class:"btn btn-light py-3 px-6 text-gray",onClick:s[4]||(s[4]=(...o)=>y.saveAccount&&y.saveAccount(...o))}," 儲存設定 ")):n("",!0)])]),_:1},8,["onSubmit"]),i(E,{ref:"dataForm",class:"content_right"},{default:_(({errors:u})=>[t("div",be,[t("div",ye,[fe,t("div",pe,[e.isEditData?C((a(),l("label",ve,[B("姓名")])),[[g,!0]]):(a(),l("label",_e,"姓名")),i(m,{name:"name",label:"姓名",type:"text",class:c(["form-control fw-bold",{"is-invalid":u.name&&e.isEditData,"border-0 p-0 bg-white  ":!e.isEditData}]),id:"name",placeholder:"輸入姓名",modelValue:e.userInfo.name,"onUpdate:modelValue":s[5]||(s[5]=o=>e.userInfo.name=o),rules:"required",disabled:!e.isEditData},null,8,["class","modelValue","disabled"]),e.isEditData?(a(),D(b,{key:2,name:"name",class:"invalid-feedback"})):n("",!0)]),t("div",we,[e.isEditData?C((a(),l("label",Ce,[B("手機號碼")])),[[g,!0]]):(a(),l("label",ge,"手機號碼")),i(m,{name:"phone",label:"手機號碼",type:"text",class:c(["form-control fw-bold",{"is-invalid":u.phone&&e.isEditData,"border-0 p-0 bg-white":!e.isEditData}]),id:"phone",placeholder:"請輸入手機號碼",modelValue:e.userInfo.phone,"onUpdate:modelValue":s[6]||(s[6]=o=>e.userInfo.phone=o),rules:"required|phone",disabled:!e.isEditData},null,8,["class","modelValue","disabled"]),e.isEditData?(a(),D(b,{key:2,name:"phone",class:"invalid-feedback"})):n("",!0)]),t("div",Be,[e.isEditData?C((a(),l("label",Ae,[B("生日")])),[[g,!0]]):(a(),l("label",De,"生日")),t("div",ke,[t("div",Ee,[e.isEditData?(a(),D(m,{key:1,name:"year",as:"select",label:"年",id:"birthday",class:c(["form-select",{"is-invalid":u.year}]),rules:"required",modelValue:e.birthday.year,"onUpdate:modelValue":s[7]||(s[7]=o=>e.birthday.year=o)},{default:_(()=>[xe,(a(),l(v,null,w(100,o=>t("option",{key:o,value:new Date().getFullYear()-(100-o)},p(new Date().getFullYear()-(100-o))+" 年 ",9,Ve)),64))]),_:2},1032,["class","modelValue"])):(a(),l("input",{key:0,type:"text",class:"form-control border-0 p-0 bg-white",value:`${e.birthday.year} 年 ${e.birthday.month} 月 ${e.birthday.day} 日`,disabled:""},null,8,Se))]),e.isEditData?(a(),l("div",Fe,[i(m,{name:"month",as:"select",label:"月",id:"birthday",class:c(["form-select",{"is-invalid":u.month}]),rules:"required",modelValue:e.birthday.month,"onUpdate:modelValue":s[8]||(s[8]=o=>e.birthday.month=o)},{default:_(()=>[Pe,(a(),l(v,null,w(12,o=>t("option",{key:o,value:o},p(o)+" 月 ",9,Ie)),64))]),_:2},1032,["class","modelValue"])])):n("",!0),e.isEditData?(a(),l("div",Ne,[i(m,{name:"day",as:"select",label:"日",id:"birthday",class:c(["form-select",{"is-invalid":u.day}]),rules:"required",modelValue:e.birthday.day,"onUpdate:modelValue":s[9]||(s[9]=o=>e.birthday.day=o)},{default:_(()=>[ze,(a(!0),l(v,null,w(e.dayRange,o=>(a(),l("option",{key:o,value:o},p(o)+" 日 ",9,Re))),128))]),_:2},1032,["class","modelValue"])])):n("",!0),e.isEditData?(a(),l("div",Ue,[i(b,{name:"year",class:"invalid-feedback"}),i(b,{name:"month",class:"invalid-feedback"}),i(b,{name:"day",class:"invalid-feedback"})])):n("",!0)])]),t("div",qe,[e.isEditData?C((a(),l("label",je,[B("地址")])),[[g,!0]]):(a(),l("label",Oe,"地址")),t("div",Le,[t("div",{class:c(["col-md-6",{"col-md-12":!e.isEditData}])},[e.isEditData?(a(),D(m,{key:1,name:"city",as:"select",label:"縣市",id:"address",class:c(["form-select",{"is-invalid":u.city}]),modelValue:e.addressSelected.city,"onUpdate:modelValue":s[10]||(s[10]=o=>e.addressSelected.city=o),rules:"required"},{default:_(()=>[Me,(a(!0),l(v,null,w(e.cityArray,o=>(a(),l("option",{key:o,value:o},p(o),9,Ye))),128))]),_:2},1032,["class","modelValue"])):(a(),l("input",{key:0,type:"text",class:"form-control border-0 p-0 bg-white fw-bold",value:`${e.addressSelected.city}${e.addressSelected.county}${e.addressSelected.detail}`,disabled:""},null,8,Te))],2),e.isEditData?(a(),l("div",Ze,[i(m,{name:"county",as:"select",label:"鄉鎮區",id:"address",class:c(["form-select",{"is-invalid":u.county}]),modelValue:e.addressSelected.county,"onUpdate:modelValue":s[11]||(s[11]=o=>e.addressSelected.county=o),rules:"required"},{default:_(()=>[He,(a(!0),l(v,null,w(y.countyArray,o=>(a(),l("option",{key:o.countyName,value:o.countyName},p(o.countyName),9,Je))),128))]),_:2},1032,["class","modelValue"])])):n("",!0),e.isEditData?(a(),l("div",We,[i(m,{name:"detail",type:"text",label:"詳細地址",class:c(["form-control",{"is-invalid":u.detail,"border-0 p-0 bg-white":!e.isEditData}]),id:"address",placeholder:"請輸入詳細地址",modelValue:e.addressSelected.detail,"onUpdate:modelValue":s[12]||(s[12]=o=>e.addressSelected.detail=o),rules:"required",disabled:!e.isEditData},null,8,["class","modelValue","disabled"]),e.isEditData?(a(),l(v,{key:0},[i(b,{name:"city",class:"invalid-feedback"}),i(b,{name:"county",class:"invalid-feedback"}),i(b,{name:"detail",class:"invalid-feedback"})],64)):n("",!0)])):n("",!0)])]),t("div",Ge,[e.isEditData?(a(),l("button",{key:1,class:"btn btn-light py-3 px-6 text-gray",onClick:s[14]||(s[14]=(...o)=>y.saveUserData&&y.saveUserData(...o))}," 儲存設定 ")):(a(),l("button",{key:0,class:"btn btn-outline-primary py-3 px-6 text-primary",onClick:s[13]||(s[13]=(...o)=>y.changeStateToEdit&&y.changeStateToEdit(...o))}," 編輯 "))])])])]),_:1},512)])]),Ke])])])}const ts=P(O,[["render",Qe],["__scopeId","data-v-3fd51deb"]]);export{ts as default};
