import{m as F,_ as x,g as P,c as l,a as s,t as p,b as i,w as _,l as V,r as E,o,h as n,n as c,e as C,f as B,j as D,F as v,i as w,p as I,d as U}from"./index-OEbCzfE_.js";import{u as N}from"./userAuthStore-yZeccZrX.js";import{Z as z}from"./zipcodes-YNp0Njm-.js";import{S as A}from"./sweetalert2.all-6m_Z_jZk.js";const q="https://hexschool-freyja.onrender.com/api/v1/",R={data(){return{userName:"",userInfo:{name:"",email:"",phone:"",birthday:"",address:{city:"",detail:"",zipcode:"",county:""},oldPassword:"",confirmPwd:"",newPassword:""},organizedData:{},cityArray:[],addressSelected:{city:"",county:"",zipcode:"",detail:""},dayRange:0,birthday:{year:"",month:"",day:""},showResetPwd:!1,isEditData:!1}},computed:{countyArray(){var d;return this.addressSelected.city?((d=this.organizedData[this.addressSelected.city])==null?void 0:d.countyList)||[]:[]}},watch:{"addressSelected.county":{handler(d){let t=this.countyArray.filter(y=>y.countyName==d.countyName);t.length>0&&(this.addressSelected.zipcode=t[0].ZipCode)},immediate:!0},"birthday.year":{handler:"handleBirthdayChange",immediate:!0},"birthday.month":{handler:"handleBirthdayChange",immediate:!0},"birthday.day":{handler:"handleBirthdayChange",immediate:!0}},methods:{...F(N,["getUserAccount","getToken"]),resetPwd(){this.showResetPwd=!0},saveAccount(){if(this.$refs.resetForm){let d={...this.userInfo},t={"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.getToken()}`};this.$refs.resetForm.validate().then(y=>{y.valid&&this.axios.put(`${q}user/`,d,{headers:t}).then(f=>{f.data.status?(A.fire({icon:"success",iconColor:"#dc3545",title:"修改成功",showConfirmButton:!1,width:"400px",customClass:{title:"fs-4"}}),this.showResetPwd=!1):A.fire({icon:"error",iconColor:"#dc3545",title:f.data.message,showConfirmButton:!1,width:"400px",customClass:{title:"fs-4"}})}).catch(f=>{A.fire({icon:"error",iconColor:"#C22538",title:f.response.data.message,showConfirmButton:!1,width:"400px",customClass:{title:"fs-4"}})})})}},changeStateToEdit(){this.isEditData=!0},saveUserData(){this.isEditData=!1},isLeapYear(d){return d%4===0&&d%100!==0||d%400===0},updateDayRange(d,t){const y=[1,3,5,7,8,10,12];this.dayRange=t===2?this.isLeapYear(d)?29:28:y.includes(t)?31:30},handleBirthdayChange(d){this.updateDayRange(this.birthday.year,d);const t=new Date(Number(this.birthday.year),Number(this.birthday.month)-1,Number(this.birthday.day));this.userInfo.birthday=t.toISOString()},handleAddressSelect(){z.forEach(d=>{const{city:t,county:y,zipcode:f}=d;this.organizedData[t]||(this.organizedData[t]={CityName:t,countyList:[]}),this.organizedData[t].countyList.push({ZipCode:String(f),countyName:y})}),this.cityArray=Object.keys(this.organizedData)},handelBirthday(){let d=this.userInfo.birthday;const t=new Date(d);this.birthday.year=t.getFullYear().toString(),this.birthday.month=(t.getMonth()+1).toString(),this.birthday.day=t.getDate().toString()}},mounted(){this.userInfo=this.getUserAccount(),this.userInfo?(this.addressSelected.detail=this.userInfo.address.detail,this.addressSelected.county=this.userInfo.address.county,this.addressSelected.city=this.userInfo.address.city,this.addressSelected.zipcode=this.userInfo.address.zipcode,this.handleAddressSelect(),this.handelBirthday()):this.$router.push({name:"login"})}},r=d=>(I("data-v-dfed3b05"),d=d(),U(),d),j={class:"container-fluid p-0 bg-black"},O={class:"user_center_banner"},L={class:"container d-flex flex-column flex-lg-row align-items-start align-items-lg-center"},T=r(()=>s("img",{src:"https://github.com/hexschool/2022-web-layout-training/blob/main/typescript-hotel/%E6%A1%8C%E6%A9%9F%E7%89%88/user1.png?raw=true",alt:"img"},null,-1)),M={class:"text-white"},Y={class:"container"},Z=r(()=>s("ul",{class:"nav user_center_menu py-7 py-lg-8",id:"userInfo",role:"tablist"},[s("li",{class:"nav-item",role:"presentation"},[s("button",{class:"nav-link active",id:"userData-tab","data-bs-toggle":"tab","data-bs-target":"#userData",type:"button",role:"tab","aria-controls":"userData","aria-selected":"true"}," 個人資料 ")]),s("li",{class:"nav-item",role:"presentation"},[s("button",{class:"nav-link",id:"userOrder-tab","data-bs-toggle":"tab","data-bs-target":"#userOrder",type:"button",role:"tab","aria-controls":"userOrder","aria-selected":"false"}," 我的訂單 ")])],-1)),H={class:"tab-content w-100",id:"userInfoContent"},W={class:"tab-pane fade show active",id:"userData",role:"tabpanel","aria-labelledby":"userData-tab"},G={class:"d-flex flex-column flex-lg-row justify-content-between"},J={class:"content_left bg-white p-5 p-md-7 rounded-4"},K=r(()=>s("h5",{class:"fw-bold mb-7"},"修改密碼",-1)),Q={class:"mb-3"},X=r(()=>s("h6",null,"電子信箱",-1)),$={class:"fw-bold"},ee={class:"row align-items-center mb-3"},se={class:"col"},te=r(()=>s("h6",null,"密碼",-1)),ae={key:0},oe=r(()=>s("input",{type:"password",value:"testnumber",class:"border-0 fw-bold",disabled:""},null,-1)),le=[oe],de={class:"col text-end"},ie={key:0,class:"mb-3"},re=r(()=>s("h6",{class:"fw-bold"},"舊密碼",-1)),ne={key:1,class:"mb-3"},ue=r(()=>s("h6",{class:"fw-bold"},"新密碼",-1)),ce={key:2,class:"mb-3"},he=r(()=>s("h6",{class:"fw-bold"},"確認新密碼",-1)),me={class:"content_right bg-white p-5 p-md-7 rounded-4 mt-3 mt-lg-0 ms-lg-7"},be={class:"row flex-column"},ye=r(()=>s("h5",{class:"fw-bold mb-7"},"基本資料",-1)),fe={class:"col mb-3"},pe={key:0,class:"form-label",for:"name"},_e={key:1,class:"form-label",for:"name"},ve={class:"col mb-3"},we={key:0,class:"form-label",for:"phone"},ge={key:1,class:"form-label",for:"phone"},Ce={class:"col mb-3"},Be={key:0,class:"form-label",for:"birthday",label:"生日"},De={key:1,class:"form-label",for:"birthday",label:"生日"},Ee={class:"row g-2"},Ae={class:"col-md-4"},ke=["value"],Se=r(()=>s("option",{value:"",selected:""},"請選擇",-1)),Ve=["value"],Fe={key:0,class:"col-md-4"},xe=r(()=>s("option",{value:"",selected:""},"請選擇",-1)),Pe=["value"],Ie={key:1,class:"col-md-4"},Ue=r(()=>s("option",{value:"",selected:""},"請選擇",-1)),Ne=["value"],ze={key:2,class:"col-md-12 d-flex flex-row"},qe={class:"col mb-3"},Re={key:0,class:"form-label",for:"address",label:"地址"},je={key:1,class:"form-label",for:"address",label:"地址"},Oe={class:"row g-2"},Le=["value"],Te=r(()=>s("option",{value:"",selected:""},"請選擇",-1)),Me=["value"],Ye={key:0,class:"col-md-6"},Ze=r(()=>s("option",{value:"",selected:""},"請選擇",-1)),He=["value"],We={key:1,class:"col-md-12"},Ge={class:"col"},Je=r(()=>s("div",{class:"tab-pane fade",role:"tabpanel","aria-labelledby":"userOrder-tab"},[s("div",{class:"row"},[s("div",{class:"col bg-white p-7 rounded-4"},"我的訂單"),s("div",{class:"col bg-white p-7 rounded-4"},"我的訂單")])],-1));function Ke(d,t,y,f,e,b){var S;const h=E("v-field"),m=E("ErrorMessage"),k=E("v-form"),g=P("required");return o(),l("div",j,[s("div",O,[s("div",L,[T,s("h1",M,"Hello，"+p((S=e.userInfo)==null?void 0:S.name),1)])]),s("div",Y,[Z,s("div",H,[s("div",W,[s("div",G,[i(k,{ref:"resetForm",onSubmit:V(b.saveAccount,["prevent"]),class:"content_left"},{default:_(({errors:u})=>[s("div",J,[K,s("div",Q,[X,s("p",$,p(e.userInfo.email),1)]),s("div",ee,[s("div",se,[te,e.showResetPwd?n("",!0):(o(),l("div",ae,le))]),s("div",de,[s("button",{class:"btn border-0 text-primary text-decoration-underline",onClick:t[0]||(t[0]=V((...a)=>b.resetPwd&&b.resetPwd(...a),["prevent"]))}," 重設 ")])]),e.showResetPwd?(o(),l("div",ie,[re,i(h,{name:"oldPassword",label:"舊密碼",type:"password",class:c(["form-control",{"is-invalid":u.oldPassword}]),id:"oldPassword",placeholder:"請輸入舊密碼",modelValue:e.userInfo.oldPassword,"onUpdate:modelValue":t[1]||(t[1]=a=>e.userInfo.oldPassword=a),rules:"required|min:8|password"},null,8,["class","modelValue"]),i(m,{name:"oldPassword",class:"invalid-feedback"})])):n("",!0),e.showResetPwd?(o(),l("div",ne,[ue,i(h,{name:"newPassword",label:"新密碼",type:"password",class:c(["form-control",{"is-invalid":u.newPassword}]),id:"newPassword",placeholder:"請輸入新密碼",modelValue:e.userInfo.newPassword,"onUpdate:modelValue":t[2]||(t[2]=a=>e.userInfo.newPassword=a),rules:"required|min:8|password"},null,8,["class","modelValue"]),i(m,{name:"newPassword",class:"invalid-feedback"})])):n("",!0),e.showResetPwd?(o(),l("div",ce,[he,i(h,{name:"confirmPassword",label:"確認新密碼",type:"password",class:c(["form-control",{"is-invalid":u.confirmPassword}]),id:"confirmPassword",placeholder:"請再輸入一次密碼",modelValue:e.userInfo.confirmPwd,"onUpdate:modelValue":t[3]||(t[3]=a=>e.userInfo.confirmPwd=a),rules:"required|confirmed:@newPassword"},null,8,["class","modelValue"]),i(m,{name:"confirmPassword",class:"invalid-feedback"})])):n("",!0),e.showResetPwd?(o(),l("button",{key:3,class:"btn btn-light py-3 px-6 text-gray",onClick:t[4]||(t[4]=(...a)=>b.saveAccount&&b.saveAccount(...a))}," 儲存設定 ")):n("",!0)])]),_:1},8,["onSubmit"]),i(k,{ref:"dataForm",class:"content_right"},{default:_(({errors:u})=>[s("div",me,[s("div",be,[ye,s("div",fe,[e.isEditData?C((o(),l("label",_e,[B("姓名")])),[[g,!0]]):(o(),l("label",pe,"姓名")),i(h,{name:"name",label:"姓名",type:"text",class:c(["form-control fw-bold",{"is-invalid":u.name&&e.isEditData,"border-0 p-0 bg-white  ":!e.isEditData}]),id:"name",placeholder:"輸入姓名",modelValue:e.userInfo.name,"onUpdate:modelValue":t[5]||(t[5]=a=>e.userInfo.name=a),rules:"required",disabled:!e.isEditData},null,8,["class","modelValue","disabled"]),e.isEditData?(o(),D(m,{key:2,name:"name",class:"invalid-feedback"})):n("",!0)]),s("div",ve,[e.isEditData?C((o(),l("label",ge,[B("手機號碼")])),[[g,!0]]):(o(),l("label",we,"手機號碼")),i(h,{name:"phone",label:"手機號碼",type:"text",class:c(["form-control fw-bold",{"is-invalid":u.phone&&e.isEditData,"border-0 p-0 bg-white":!e.isEditData}]),id:"phone",placeholder:"請輸入手機號碼",modelValue:e.userInfo.phone,"onUpdate:modelValue":t[6]||(t[6]=a=>e.userInfo.phone=a),rules:"required|phone",disabled:!e.isEditData},null,8,["class","modelValue","disabled"]),e.isEditData?(o(),D(m,{key:2,name:"phone",class:"invalid-feedback"})):n("",!0)]),s("div",Ce,[e.isEditData?C((o(),l("label",De,[B("生日")])),[[g,!0]]):(o(),l("label",Be,"生日")),s("div",Ee,[s("div",Ae,[e.isEditData?(o(),D(h,{key:1,name:"year",as:"select",label:"年",id:"birthday",class:c(["form-select",{"is-invalid":u.year}]),rules:"required",modelValue:e.birthday.year,"onUpdate:modelValue":t[7]||(t[7]=a=>e.birthday.year=a)},{default:_(()=>[Se,(o(),l(v,null,w(100,a=>s("option",{key:a,value:new Date().getFullYear()-(100-a)},p(new Date().getFullYear()-(100-a))+" 年 ",9,Ve)),64))]),_:2},1032,["class","modelValue"])):(o(),l("input",{key:0,type:"text",class:"form-control border-0 p-0 bg-white",value:`${e.birthday.year} 年 ${e.birthday.month} 月 ${e.birthday.day} 日`,disabled:""},null,8,ke))]),e.isEditData?(o(),l("div",Fe,[i(h,{name:"month",as:"select",label:"月",id:"birthday2",class:c(["form-select",{"is-invalid":u.month}]),rules:"required",modelValue:e.birthday.month,"onUpdate:modelValue":t[8]||(t[8]=a=>e.birthday.month=a)},{default:_(()=>[xe,(o(),l(v,null,w(12,a=>s("option",{key:a,value:a},p(a)+" 月 ",9,Pe)),64))]),_:2},1032,["class","modelValue"])])):n("",!0),e.isEditData?(o(),l("div",Ie,[i(h,{name:"day",as:"select",label:"日",id:"birthday3",class:c(["form-select",{"is-invalid":u.day}]),rules:"required",modelValue:e.birthday.day,"onUpdate:modelValue":t[9]||(t[9]=a=>e.birthday.day=a)},{default:_(()=>[Ue,(o(!0),l(v,null,w(e.dayRange,a=>(o(),l("option",{key:a,value:a},p(a)+" 日 ",9,Ne))),128))]),_:2},1032,["class","modelValue"])])):n("",!0),e.isEditData?(o(),l("div",ze,[i(m,{name:"year",class:"invalid-feedback"}),i(m,{name:"month",class:"invalid-feedback"}),i(m,{name:"day",class:"invalid-feedback"})])):n("",!0)])]),s("div",qe,[e.isEditData?C((o(),l("label",je,[B("地址")])),[[g,!0]]):(o(),l("label",Re,"地址")),s("div",Oe,[s("div",{class:c(["col-md-6",{"col-md-12":!e.isEditData}])},[e.isEditData?(o(),D(h,{key:1,name:"city",as:"select",label:"縣市",id:"address",class:c(["form-select",{"is-invalid":u.city}]),modelValue:e.addressSelected.city,"onUpdate:modelValue":t[10]||(t[10]=a=>e.addressSelected.city=a),rules:"required"},{default:_(()=>[Te,(o(!0),l(v,null,w(e.cityArray,a=>(o(),l("option",{key:a,value:a},p(a),9,Me))),128))]),_:2},1032,["class","modelValue"])):(o(),l("input",{key:0,type:"text",class:"form-control border-0 p-0 bg-white fw-bold",value:`${e.addressSelected.city}${e.addressSelected.county}${e.addressSelected.detail}`,disabled:""},null,8,Le))],2),e.isEditData?(o(),l("div",Ye,[i(h,{name:"county",as:"select",label:"鄉鎮區",id:"address2",class:c(["form-select",{"is-invalid":u.county}]),modelValue:e.addressSelected.county,"onUpdate:modelValue":t[11]||(t[11]=a=>e.addressSelected.county=a),rules:"required"},{default:_(()=>[Ze,(o(!0),l(v,null,w(b.countyArray,a=>(o(),l("option",{key:a.countyName,value:a.countyName},p(a.countyName),9,He))),128))]),_:2},1032,["class","modelValue"])])):n("",!0),e.isEditData?(o(),l("div",We,[i(h,{name:"detail",type:"text",label:"詳細地址",class:c(["form-control",{"is-invalid":u.detail,"border-0 p-0 bg-white":!e.isEditData}]),id:"address3",placeholder:"請輸入詳細地址",modelValue:e.addressSelected.detail,"onUpdate:modelValue":t[12]||(t[12]=a=>e.addressSelected.detail=a),rules:"required",disabled:!e.isEditData},null,8,["class","modelValue","disabled"]),e.isEditData?(o(),l(v,{key:0},[i(m,{name:"city",class:"invalid-feedback"}),i(m,{name:"county",class:"invalid-feedback"}),i(m,{name:"detail",class:"invalid-feedback"})],64)):n("",!0)])):n("",!0)])]),s("div",Ge,[e.isEditData?(o(),l("button",{key:1,class:"btn btn-light py-3 px-6 text-gray",onClick:t[14]||(t[14]=(...a)=>b.saveUserData&&b.saveUserData(...a))}," 儲存設定 ")):(o(),l("button",{key:0,class:"btn btn-outline-primary py-3 px-6 text-primary",onClick:t[13]||(t[13]=(...a)=>b.changeStateToEdit&&b.changeStateToEdit(...a))}," 編輯 "))])])])]),_:1},512)])]),Je])])])}const ss=x(R,[["render",Ke],["__scopeId","data-v-dfed3b05"]]);export{ss as default};
